# DS-053: 质量检查单标准

**版本**: v1.4.0  
**标准类型**: T2-DS实现标准  
**用途**: 需求质量验证 ("需求的单元测试")  
**生成时机**: State B (Analyze完成后)

---

## 标准概述

**核心理念**: 检查单是"需求的单元测试" - 验证需求的**质量、清晰度、完整性**，而非验证代码实现。

### ❌ 不用于验证实现

- ❌ "验证按钮点击正确"
- ❌ "测试错误处理工作"
- ❌ "确认API返回200"
- ❌ 检查代码是否匹配Spec

### ✅ 用于验证需求质量

- ✅ "是否所有卡片类型都定义了视觉层级要求？" (完整性)
- ✅ "'显著显示'是否量化了具体尺寸/位置？" (清晰度)
- ✅ "交互元素的悬停状态要求是否一致？" (一致性)
- ✅ "键盘导航要求是否定义？" (覆盖)
- ✅ "Logo图片加载失败时的行为是否定义？" (边界情况)

**类比**: 如果你的Spec是用英文写的代码，检查单就是它的单元测试套集。

---

## 检查单结构

每个检查项必须遵循以下格式：

```markdown
- [ ] CHK### - [问题描述] [质量维度, Spec引用]
```

### 质量维度分类

| 维度 | 说明 | 示例 |
|------|------|------|
| **Completeness** | 所有必要需求是否记录？ | "错误处理需求是否覆盖所有API失败模式？" |
| **Clarity** | 需求是否明确无歧义？ | "'快速加载'是否量化了具体时间阈值？" |
| **Consistency** | 需求之间是否一致？ | "导航需求在所有页面是否一致？" |
| **Measurability** | 验收标准是否可测量？ | "视觉层级要求是否可客观验证？" |
| **Coverage** | 所有流程/情况是否覆盖？ | "零状态场景(无数据)的需求是否定义？" |
| **Edge Cases** | 边界条件是否定义？ | "网络中断时的行为是否定义？" |
| **NFRs** | 性能/安全/可访问性是否指定？ | "安全需求是否覆盖所有受保护资源？" |

### ID格式

- 全局递增ID: `CHK001`, `CHK002`, ... `CHK999`
- 每个`/cdd.checklist`命令创建**新文件**
- 使用描述性名称: `ux.md`, `api.md`, `security.md`

---

## 检查项编写规则

### ✅ 正确模式 (测试需求质量)

```markdown
- [ ] CHK001 - 功能需求是否覆盖所有用户操作场景？ [Completeness, Spec §FR-1]
- [ ] CHK002 - "显著显示"是否量化了具体尺寸/位置？ [Clarity, Spec §FR-4]
- [ ] CHK003 - 悬停状态要求在所有交互元素间是否一致？ [Consistency, Spec §FR-3]
- [ ] CHK004 - 键盘导航要求是否定义？ [Coverage, Gap]
- [ ] CHK005 - Logo图片加载失败时的回退行为是否定义？ [Edge Case, Gap]
- [ ] CHK006 - "快速加载"是否量化了具体时间阈值？ [Measurability, Spec §NFR-2]
```

### ❌ 错误模式 (测试实现)

```markdown
# 错误 - 这些测试的是实现，不是需求
- [ ] CHK001 - 验证首页显示3个卡片 [Spec §FR-001]
- [ ] CHK002 - 测试悬停状态在桌面正常工作 [Spec §FR-003]
- [ ] CHK003 - 确认Logo点击导航到首页 [Spec §FR-010]
- [ ] CHK004 - 检查相关片段显示3-5项 [Spec §FR-005]
```

### 关键区别

| 错误 | 正确 |
|------|------|
| 测试系统是否正常工作 | 测试需求是否写清楚 |
| 验证行为 | 验证需求质量 |
| "Does it do X?" | "Is X clearly specified?" |
| 实现细节 | 需求完整性/清晰度 |

---

## 场景分类检查

### 需求质量检查矩阵

| 场景类 | 检查问题 |
|--------|----------|
| **Primary** | 主流程需求是否完整、清晰？ |
| **Alternate** | 备选流程需求是否定义？ |
| **Exception/Error** | 错误处理需求是否覆盖所有失败模式？ |
| **Recovery** | 恢复/回滚需求是否定义？ |
| **Non-Functional** | 性能、安全、可访问性是否指定？ |

### 示例

```markdown
## 需求完整性检查

- [ ] CHK001 - 主要用户流程的需求是否完整？ [Primary Flow, Completeness]
- [ ] CHK002 - 备选用户流程(非Happy Path)是否定义？ [Alternate Flow, Gap]
- [ ] CHK003 - 所有API错误响应格式是否定义？ [Exception Flow, Completeness]
- [ ] CHK004 - 迁移失败时的回滚需求是否定义？ [Recovery, Gap]
- [ ] CHK005 - 性能要求是否量化了具体指标？ [NFR, Clarity]
```

---

## 可追溯性要求

- **最低标准**: ≥80%的检查项必须包含至少一个可追溯引用
- **引用格式**:
  - `[Spec §X.Y]` - Spec中已有需求
  - `[Gap]` - 检查缺失需求
  - `[Ambiguity]` - 检查模糊表述
  - `[Conflict]` - 检查冲突
  - `[Assumption]` - 检查假设

---

## 生成流程

### Step 1: 澄清意图 (动态生成)

根据用户输入和Spec内容，生成最多3个澄清问题：

1. **范围精炼**: "X和Y的集成触点是否在范围内？"
2. **风险优先级**: "哪些潜在风险区域应获得强制门禁检查？"
3. **深度校准**: "这是轻量级预提交检查还是正式发布门禁？"
4. **受众**: "仅作者使用还是PR审查时使用？"

### Step 2: 加载上下文

从Memory Bank加载：
- DS-050 (功能需求)
- DS-051 (技术细节)
- DS-052 (任务列表)

### Step 3: 生成检查项

按质量维度分组创建检查项：

```markdown
# 质量检查单: {功能名称}

**生成时间**: {{TIMESTAMP}}  
**关注领域**: {ux/api/security/performance}  
**深度级别**: Standard/Deep  

## 需求完整性 (Completeness)

- [ ] CHK001 - ...
- [ ] CHK002 - ...

## 需求清晰度 (Clarity)

- [ ] CHK003 - ...
- [ ] CHK004 - ...

## 需求一致性 (Consistency)

- [ ] CHK005 - ...
- [ ] CHK006 - ...

## 场景覆盖 (Coverage)

- [ ] CHK007 - ...
- [ ] CHK008 - ...

## 边界情况 (Edge Cases)

- [ ] CHK009 - ...
- [ ] CHK010 - ...

## 非功能需求 (NFRs)

- [ ] CHK011 - ...
- [ ] CHK012 - ...
```

---

## 集成到CDD工作流

### State B (新增输出)

```
State B: 规划阶段
├── Clarify → Specify → Plan → Tasking
├── Analyze (WF-ANALYZE) - 门禁
└── Checklist生成 (DS-053) - 输出需求质量检查单
```

### State E (验收)

在State E完成时，逐项勾选DS-053检查单作为验收标准。

---

## 统计报告

生成检查单后输出：

```
✅ 检查单已生成: memory_bank/checklists/{domain}.md
📊 检查项数量: XX
🎯 关注领域: {领域}
📋 深度级别: Standard

请在State E完成时逐项验收。
```

---

**标准版本**: v1.4.0  
**最后更新**: {{timestamp}}  
**来源**: spec-kit checklist.md
