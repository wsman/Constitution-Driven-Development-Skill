# WF-206: Refactor Protocol (é‡æ„åè®®)

**ç±»å‹**: T2 (Protocol)
**ç‰ˆæœ¬**: v1.8.0
**ç”¨é€”**: ç³»ç»Ÿç†µå€¼è¿‡é«˜æ—¶çš„é‡æ„å·¥ä½œæµç¨‹

---

## 1. è§¦å‘æ¡ä»¶

å½“ç³»ç»Ÿç†µå€¼ $H_{sys} > 0.7$ æ—¶ï¼Œè§¦å‘**ç†µå€¼å±æœºåè®®**ï¼Œå¿…é¡»æ‰§è¡Œæ­¤é‡æ„åè®®ã€‚

**ç†µå€¼é˜ˆå€¼**:
| èŒƒå›´ | çŠ¶æ€ | è¡ŒåŠ¨ |
|------|------|------|
| 0.0 - 0.3 | ğŸŸ¢ ä¼˜ç§€ | æ­£å¸¸å¼€å‘ |
| 0.3 - 0.5 | ğŸŸ¡ è‰¯å¥½ | å¯ç»§ç»­å¼€å‘ |
| 0.5 - 0.7 | ğŸŸ  è­¦å‘Š | å»ºè®®é‡æ„ |
| > 0.7 | ğŸ”´ å±é™© | **åœæ­¢æ–°åŠŸèƒ½ï¼Œå¼ºåˆ¶é‡æ„** |

---

## 2. é‡æ„æµç¨‹

### Phase 1: åœæ­¢ä¸è¯„ä¼° (Stop & Assess)

```bash
# 1. åœæ­¢æ‰€æœ‰æ–°åŠŸèƒ½å¼€å‘
# 2. è¿è¡Œç†µå€¼æµ‹é‡
python scripts/measure_entropy.py --verbose

# 3. æŸ¥çœ‹ç†µå€¼åˆ†è§£
python scripts/measure_entropy.py --json | jq '.components'
```

**è¾“å‡ºè¦æ±‚**:
- è®°å½•å½“å‰ $H_{cog}$, $H_{struct}$, $H_{align}$ å€¼
- è¯†åˆ«ç†µå€¼æœ€é«˜çš„ç»„ä»¶

### Phase 2: ä¼˜å…ˆçº§æ’åº (Prioritize)

æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§æ‰§è¡Œé‡æ„ï¼š

| ä¼˜å…ˆçº§ | é‡æ„ç±»å‹ | é¢„æœŸç†µå‡ | å‚è€ƒæ–‡æ¡£ |
|--------|----------|----------|----------|
| **P0** | Tier 1 ç»“æ„è¿å | $\Delta H_{struct} \approx -0.2$ | `system_patterns.md` |
| **P1** | Tier 2 ç­¾åç¼ºå¤± | $\Delta H_{align} \approx -0.15$ | `tech_context.md` |
| **P2** | Tier 3 è¡Œä¸ºå¤±è´¥ | $\Delta H_{cog} \approx -0.1$ | `behavior_context.md` |
| **P3** | æ¸…ç†æœªä½¿ç”¨ä»£ç  | $\Delta H_{sys} \approx -0.05$ | - |

### Phase 3: æ‰§è¡Œé‡æ„ (Execute)

```bash
# å¯¹æ¯ä¸ªä¼˜å…ˆçº§æ‰§è¡Œé‡æ„
# P0: ä¿®å¤ç›®å½•ç»“æ„
tree src/  # å¯¹æ¯” system_patterns.md

# P1: è¡¥å……ç¼ºå¤±æ¥å£
grep -r "def.*(" src/ --include="*.py"  # å¯¹æ¯” tech_context.md

# P2: ä¿®å¤å¤±è´¥æµ‹è¯•
pytest tests/ -v --tb=short
```

### Phase 4: éªŒè¯ (Verify)

```bash
# é‡æ–°æµ‹é‡ç†µå€¼
python scripts/measure_entropy.py --verbose

# ç¡®è®¤ç†µå€¼ä¸‹é™
# ç›®æ ‡: H_sys <= 0.5
```

### Phase 5: è®°å½• (Document)

```markdown
# æ›´æ–° active_context.md ä¸­çš„ç†µå€¼ç›‘æµ‹ä»ªè¡¨ç›˜
| æ—¥æœŸ | H_cog | H_struct | H_align | H_sys | çŠ¶æ€ |
|------|-------|----------|---------|-------|------|
| YYYY-MM-DD | X.XX | X.XX | X.XX | X.XX | âœ…/âš ï¸ |
```

---

## 3. é‡æ„æ£€æŸ¥æ¸…å•

- [ ] åœæ­¢æ‰€æœ‰æ–°åŠŸèƒ½å¼€å‘
- [ ] è®°å½•å½“å‰ç†µå€¼çŠ¶æ€
- [ ] è¯†åˆ«é«˜ç†µç»„ä»¶
- [ ] æŒ‰ä¼˜å…ˆçº§æ‰§è¡Œé‡æ„
- [ ] éªŒè¯ç†µå€¼ä¸‹é™
- [ ] æ›´æ–° `active_context.md`
- [ ] æäº¤é‡æ„å˜æ›´

---

## 4. ç†µå€¼ä¼˜åŒ–æŠ€å·§

### 4.1 é™ä½è®¤çŸ¥ç†µ ($H_{cog}$)
- ç®€åŒ–å¤æ‚é€»è¾‘
- æ·»åŠ æ¸…æ™°çš„æ³¨é‡Šå’Œæ–‡æ¡£
- ç»Ÿä¸€å‘½åè§„èŒƒ

### 4.2 é™ä½ç»“æ„ç†µ ($H_{struct}$)
- è§„èŒƒåŒ–ç›®å½•ç»“æ„
- ç§»é™¤å¾ªç¯ä¾èµ–
- æ¨¡å—åŒ–è®¾è®¡

### 4.3 é™ä½å¯¹é½ç†µ ($H_{align}$)
- ç¡®ä¿ä»£ç ä¸æ–‡æ¡£åŒæ­¥
- è¡¥å……ç¼ºå¤±çš„æ¥å£å®ç°
- æ›´æ–°è¿‡æ—¶çš„æµ‹è¯•ç”¨ä¾‹

---

**å®ªæ³•ä¾æ®**: Â§102Â§301
**æœ€åæ›´æ–°**: {{TIMESTAMP}}
**ç‰ˆæœ¬**: v1.8.0